## DDD важно сегодня: Интервью с Эриком Эвансом

InfoQ.com поговорил с основателем Предметно-ориентированным проектированием Эриком Эвансом, чтобы поместить DDD в современный контекст:

### Почему DDD сегодня так же важно, как и раньше?

По сути, DDD это принцип, мы должны держать фокус на глубоких проблемах домена, в котором живут наши пользователи, направлять лучшие когнитивные усилия на понимание этого домена, и вместе с доменными экспертами вытаскивать концептуальную модель, с которой уже можно строить мощный, гибкий софт.

Это принцип, который не выходит из моды. Он работает всякий раз, когда мы имеем дело со сложным, запутанным доменом.

Долгосрочный тренд такой, софт всё чаще применяют к всё более сложным задачам, всё глубже внутри бизнеса. Мне кажется, этот тренд на несколько лет прерывался, когда на нас обрушился веб. Внимание ушло от богатой доменной логики и глубоких решений, потому что уже сама возможность просто вынести данные в веб и добавить к ним совсем простое поведение давала огромную ценность. Работы такого типа было много, а даже “простые вещи” в вебе какое-то время делать было трудно и это съедало почти весь ресурс разработки.

Но теперь базовый уровень освоения веба в целом “переварен”, и проекты снова становятся более амбициозными в части бизнес-логики.

Совсем недавно веб-платформы начали достаточно созревать, чтобы веб-разработка стала продуктивной и для DDD, и виден ряд позитивных тенденций. Например, SOA — если использовать её правильно — даёт очень полезный способ изолировать доменную модель (выделить доменный слой) от остальной системы.

Параллельно agile-практики успели повлиять настолько, что большинство проектов как минимум стремятся работать итеративно, тесно взаимодействовать с бизнесом, применять CI и жить в среде с высокой плотностью коммуникации.

Поэтому похоже, что в обозримом будущем DDD будет становиться только важнее, и некоторые основания для этого уже заложены.

### Технологические платформы (Java, .NET, Ruby и другие) постоянно эволюционируют. Как сюда вписывается DDD?

Вообще-то новые технологии и процессы стоит оценивать по тому, помогают ли они командам держать фокус на домене, а не отвлекают ли от него. DDD не привязано к конкретной платформе, но разные платформы по-разному поддерживают выразительное кодирование бизнес-логики и по-разному нагружают разработку техническим шумом. И если говорить именно о снижении шума, то последние несколько лет выглядят обнадёживающе, особенно после ужасного конца 1990х.

Java была выбором “по умолчанию” в последние годы, а по выразительности она типична для объектно-ориентированных языков. Что до технического мусора, базовый язык не так уж плох. В нём есть сборка мусора, которая на практике оказывается критически важной (в отличие от C++, где слишком много внимания уходит на низкоуровневые детали). В синтаксисе Java есть лишнее, но plain old java objects (POJO) всё ещё можно писать читабельно. Плюс некоторые нововведения Java 5 улучшают читаемость.

Но когда появились первые J2EE-фреймворки, они полностью закопали эту базовую выразительность под горами кода фреймворка. Следование ранним канонам (вроде EJB home, аксессоров get/set с префиксами для всех переменных и т. п.) порождало ужасные объекты. Инструментарий был настолько тяжеловесным, что у команд уходила почти вся ёмкость просто на то, чтобы заставить это работать. А после того как на проект вываливалась огромная каша из сгенерированного кода и XML, менять объекты становилось настолько трудно, что их почти переставали менять. Это была платформа, на которой эффективное доменное моделирование становилось почти невозможным.

Добавьте к этому императив делать веб-интерфейсы поверх HTTP и HTML (которые для этого не проектировались) при помощи довольно примитивных инструментов первого поколения. В тот период создание и сопровождение приличного UI становились настолько сложными, что на дизайн сложной внутренней функциональности почти не оставалось внимания. Иронично, но ровно в тот момент, когда объектные технологии победили, продвинутое моделирование и проектирование получили сильный удар.

На платформе .NET ситуация была похожей, какие-то проблемы там решались чуть лучше, какие-то чуть хуже.

Период был демотивирующим, но примерно за последние четыре года тренд развернулся. Если смотреть на Java, то совпали две вещи, сообщество стало гораздо зрелее в том, как использовать фреймворки выборочно и появилось множество новых фреймворков (в основном open-source), которые постепенно улучшают картину. Фреймворки вроде Hibernate и Spring закрывают конкретные задачи, которые J2EE пытался решать “всё сразу”, но намного легче. Появились подходы вроде AJAX, которые пытаются решать UI проблему с меньшими трудозатратами. И проекты стали заметно умнее в том, как выбирать из J2EE только то, что реально даёт ценность, и смешивать это с более новыми компонентами. Именно в эту эпоху появился термин POJO.

Результат это постепенное, но заметное снижение технической нагрузки на проекты и явный прогресс в отделении бизнес-логики от остальной системы так, чтобы её можно было писать в терминах POJO. Это само по себе не гарантирует DDD, но делает его реалистичной возможностью.

Это про мир Java. Дальше идут “новички” вроде Ruby. У Ruby очень выразительный синтаксис, и на базовом уровне это должен быть очень хороший язык для DDD (хотя я пока не слышал о широком применении Ruby именно в таких доменно-насыщенных системах). Rails вызвал много восторга, потому что, похоже, наконец сделал разработку веб-интерфейсов такой же простой, какой она была в начале 1990х до веба. Пока что эту возможность в основном используют для построения огромного количества веб-приложений, у которых за интерфейсом нет богатого домена — просто потому, что даже такие приложения раньше было мучительно сложно делать. Но я надеюсь, что по мере удешевления UI люди увидят в этом шанс перенести больше внимания на домен. Если использование Ruby когда-нибудь двинется в эту сторону, думаю, это может стать отличной платформой для DDD (хотя, вероятно, придётся закрыть несколько инфраструктурных пробелов).

Ещё более “на переднем крае” попытки в области domain-specific languages (DSL). Я давно считаю, что это может стать следующим большим шагом для DDD. Пока у нас всё ещё нет инструмента, который действительно даёт то, что нужно. Но люди экспериментируют в этой области как никогда активно и это внушает надежду.

Сейчас, насколько я могу судить, большинство тех, кто пытается применять DDD, работают на Java или .NET, и лишь немногие на Smalltalk. Поэтому именно позитивные изменения в Java мире дают самый заметный эффект прямо сейчас.

### Что происходит в DDD-сообществе с тех пор, как вы написали свою книгу?

Меня особенно радует, когда люди берут принципы, о которых я говорил в книге, и применяют их так, как я бы сам не ожидал. Один пример — использование стратегического дизайна в StatOil, норвежской национальной нефтяной компании. Их архитекторы написали отчёт по опыту применения. (Прочитать можно здесь: http://domaindrivendesign.org/articles/.)

Помимо прочего, они взяли Карту контекстов и применили его как рамку для оценки готового коробочного ПО при выборе между собственной разработкой и покупкой.

В качестве совсем другого примера: некоторые из нас исследуют ряд вопросов, разрабатывая Java-библиотеку базовых доменных объектов, которые нужны многим проектам. Посмотреть можно здесь:

http://timeandmoney.domainlanguage.com

Например, мы изучаем, как далеко можно продвинуть идею встроенного DSL домена через fluent-интерфейсы, оставаясь при этом в реализации на Java.

Там много всего происходит. Я всегда ценю, когда люди пишут мне и рассказывают, что они делают.

### Do you have any advice for people trying to learn DDD today?

Read my book! ;-) Also, try using timeandmoney on your project. One of our original objectives was to provide a good example that people could learn from by using it.

One thing to keep in mind is that DDD is largely something teams do, so you may have to be an evangelist. Realistically, you may want to go search for a project where they are making an effort to do this.

Keep in mind some of the pitfalls of domain modeling:
1. Stay hands-on. Modelers need to code.
2. Focus on concrete scenarios. Abstract thinking has to be anchored in concrete cases.
3. Don’t try to apply DDD to everything. Draw a context map and decide on where you will make a push for DDD and where you will not. And then don’t worry about it outside those boundaries.
4. Experiment a lot and expect to make lots of mistakes. Modeling is a creative process.

### Есть ли у вас советы тем, кто сегодня пытается изучать DDD?

Читайте мою книгу! ;-)

Ещё попробуйте timeandmoney у себя на проекте, хотя бы как учебный пример. Одна из наших изначальных целей как раз была в том, чтобы дать хороший образец, на котором можно учиться, просто используя библиотеку.

Важно помнить, что DDD во многом является командной практикой, так что вам, возможно, придётся быть евангелистом и продавать подход. На практике, возможно, стоит поискать проект, где уже есть осознанная попытка работать в этом стиле.

Держите в голове некоторые типичные ловушки доменного моделирования:

1. Не отрывайтесь от кода. Те, кто моделирует, должны кодить.
2. Держите фокус на конкретных сценариях. Абстракции должны быть заякорены в реальных кейсах.
3. Не пытайтесь применять DDD везде. Нарисуйте карту контекстов и решите, где вы целенаправленно инвестируете в DDD, а где нет. А дальше не переживайте о том, что происходит за пределами этих границ.
4. Много экспериментируйте и сразу закладывайте, что ошибок будет много. Моделирование — процесс творческий.